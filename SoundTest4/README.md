# SoundTest4 4音源 PWM / 4 sound sources PWM  <!-- omit in toc -->

* 1ビット音源でも, PWM を使えば自然な音を鳴らすことが可能です. MZ-700 で実現しました

## 目次 <!-- omit in toc -->
- [原理](#原理)
- [機能](#機能)
- [実装サンプルについて](#実装サンプルについて)

## 原理
* 8253のモード0を PWM (パルス幅変調) として使用し, MZ-700 とは思えない音色を実現しました<br>
  ![合成原理](SoundTest4.png)
* VRAM のアクセスと同期し, 処理ループは約 15.7KHz で固定です.<br>
  原理上, この 15.7KHz のノイズ (昔のブラウン管の TV でアナログ放送を受信しているときの音) が入ります.<br>
  気になる場合はスピーカー側にローパスフィルタを入れてください

## 機能
* Lead x 1ch:
  * 矩形波
  * 3種類のエンベロープ (減衰速度調整可能)
  * スラー, ポルタメント (速度調整可能)
* Chord x 1ch:
  * 矩形波
  * 3種類のエンベロープ (減衰速度は固定)
  * 1音をアルペジオで演奏します
* Base x 1ch:
  * 矩形波
  * 3種類のエンベロープ (減衰速度は固定)
* Drum x 1ch:
  * PCM
  * 6bit, 7.85kHz, 256 サンプル (約0.033秒) x 3種類
  * 波形データはなんと BMP ファイルを変換して作ります
  * 連打してもテンポの遅れはありません
* リピート (最大8回 x 4重ネスト)
* F1 及び F2 キーによる中断機能 (中断禁止にもできます)
* Lead, Chord, Base の音源の合成は加算ですが, Drum の合成は OR です
* 波形 OR 合成方式に比べると, 少し音が小さめです

## 実装サンプルについて
* サンプル曲として Tim Follin 氏の 'Chronos' をカバーしました.<br>
  再生時間は約3分です
* リピートによるランレングス圧縮のおかげで, 音符量が約 3/4 になってます
* 終了したらモニター ROM に戻ります (たぶん). <br>
  実行アドレスは, 0x1200 なので再実行できます
